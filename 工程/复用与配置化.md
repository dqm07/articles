<!--
 * @Author: dongqingming
 * @Date: 2021-01-22 11:28:16
 * @LastEditTime: 2021-02-03 20:24:57
 * @LastEditors: dongqingming
 * @Description: 复用与配置化
 * @FilePath: /articles/工程/复用与配置化.md
 * @no bug no code
-->
# 复用的粒度
这是一次没有标准答案的探索，但是我们还是有一些原则可依据，需要`因地制宜`地去约定复用的粒度。
## 具备抽象意识
探讨粒度的前提是要有抽象的意识，不再是面向过程的开发流程，抽象思维就是看需求共性，下沉基础能力。首先是有抽象意识，自己要意识到我要抽象，其次就是怎么抽象。
看一个例子
```js
http://fangyuan.intra.xiaojukeji.com/#/rules/modifyV3/30105
// 规则/策略背景
// 规则内容
// 面相过程怎么开发
自上而下的开发，完成需求功能即可，反观代码会有很多的重复代码
// 抽象思考怎么开发
1、label + input下沉
2、大模块的抽象配置化
```
## 如何抽象
这背后其实就是抽象的粒度，一定抽的越细致约好吗，不抽象是不是也可以？

不抽象——————————————————————————————过度抽象

我们探讨的是中间态，有一些原则可提供。
### 原则
先从一个例子入手看看，参与互动，怎么抽象，这其中我们用到了哪些原则
- 原子组件：不可再拆分
- 分子组件：存在一定可操作性【label + input】
- 生物组件：环境产物【label + input + search + reset】
- 模板组件：复杂的生物组件、逻辑组件，最终归并到页面中

一些经验谈
- “状态组件无模板，模板组件无状态”
```js
# 状态组件无模板 - hooks
# 模板组件无状态 - UI组件

很好理解，不做过多地解释
```
- 业务复用 > 代码复用
```js
# 举一个例子
分层的概念：业务层的复用价值更大，代码复用解决不了业务重写的问题
```
- repeat >= 2就是有意义
- 分而治之，降低维护成本
```js
# 粒度和维护之间的平衡
# 举例什么适合拆分、什么更利于维护
```
- 状态管理建议props或者hooks，组件的原则
```js
# 更好地解耦
# 如果嵌入状态有什么问题
# mixin就是个例子
```
- 不确定的项目可以尝试渐进的方式趋于完善
```js
# 渐进式：egg中的插件与中间件的关系
# 项目里可以进行逐层的下沉
```
- 组件化 Vs 分层
```js
# 组件化和分层
```
- 我们看看粒度很细的方式有什么TailWindcss
```js
# 粒度很细的一种方案
# 维护成本
- 一层，不会出现嵌套的结构，为什么嵌套不好用
- 各个样式之间解耦性比较好
- 组合优于继承，更好扩展
- 可以组合成更复杂的集合
- 自定义简单
```
- 开闭原则, 对修改关闭, 对扩展开放
```
Membrane Mode: https://mp.weixin.qq.com/s/BYIay7w7BRRfar6zbzuNOw

webpack plugin，固定阶段暴露hook给用户自定义
```
- 继承、抽象、封装
- 3的原则
```js
# 三比较容易维护
# 第一次实现、第二次思考复用抽离、第三次直接复用
```

```
组件封装原则：
  标准性：所有组件同样一套标准
  独立性：单一职责原则
  复用和易用
  短小精悍
  STOP法则：single point of truth
  避免暴露组件内逻辑
  避免直接操作dom，避免ref
  入口处检查参数有效性，出口处检查返回的正确性
  无环依赖原则
  稳定抽象原则：抽象程度决定了稳定性
  避免冗余状态：同层级复用，抽象到父节点
  合理的依赖关系
  扁平化参数
  良好的接口设计
  api尽量和已知概念保持一致

划分：
  基础组件
    antd elementUI等
  容器型组件
  展示型组件
    stateless组件
  业务组件
    常规components
  通用组件
    ui组件
      props、events和slots即可交互
    逻辑组件
      功能组件
  高阶组件

边界：
  不超过三层（容器、业务和通用）
  拆分是否再有必要？
```

### 总结
react: 逻辑处理中间件思路（数据单向流进行劫持，异常处理机制拦截，react拥有双向流）ErrorBoundary
jsx模板化，通过babel-plugin进行支持即可
